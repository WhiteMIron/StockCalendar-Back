const Hangul = require('hangul-js');

const ConsonantEndingMap = new Map([
    ['ㄱ', ['가', '까']],
    ['ㄲ', ['까', '나']],
    ['ㄴ', ['낙', '닥']],
    ['ㄷ', ['다', '따']],
    ['ㄸ', ['따', '라']],
    ['ㄹ', ['라', '마']],
    ['ㅁ', ['마', '바']],
    ['ㅂ', ['바', '빠']],
    ['ㅃ', ['빠', '사']],
    ['ㅅ', ['사', '싸']],
    ['ㅆ', ['싸', '아']],
    ['ㅇ', ['아', '자']],
    ['ㅈ', ['자', '짜']],
    ['ㅉ', ['짜', '차']],
    ['ㅊ', ['차', '카']],
    ['ㅋ', ['카', '타']],
    ['ㅌ', ['타', '파']],
    ['ㅍ', ['파', '하']],
    ['ㅎ', ['하', '힣']],
]);

const VowelEndingtMap = new Map([
    ['가', ['가', '갛']],
    ['갸', ['갸', '걓']],
    ['거', ['거', '겋']],
    ['겨', ['겨', '곃']],
    ['고', ['고', '굫']],
    ['교', ['교', '굫']],
    ['구', ['구', '궇']],
    ['규', ['규', '귷']],
    ['그', ['그', '긓']],
    ['기', ['기', '깋']],

    ['나', ['나', '낳']],
    ['냐', ['냐', '낳']],
    ['너', ['너', '넣']],
    ['녀', ['녀', '녛']],
    ['노', ['노', '놓']],
    ['뇨', ['뇨', '눃']],
    ['누', ['누', '늏']],
    ['뉴', ['뉴', '늏']],
    ['느', ['느', '늫']],
    ['니', ['니', '닣']],

    ['다', ['다', '닿']],
    ['댜', ['댜', '댷']],
    ['더', ['더', '덯']],
    ['뎌', ['뎌', '뎧']],
    ['도', ['도', '돟']],
    ['됴', ['됴', '둏']],
    ['두', ['두', '듛']],
    ['듀', ['듀', '듛']],
    ['드', ['드', '듷']],
    ['디', ['디', '딯']],

    ['라', ['라', '랗']],
    ['랴', ['랴', '럏']],
    ['러', ['러', '렇']],
    ['려', ['려', '렿']],
    ['로', ['로', '롷']],
    ['료', ['료', '룧']],
    ['루', ['루', '뤃']],
    ['류', ['류', '륳']],
    ['르', ['르', '릏']],
    ['리', ['리', '맇']],

    ['마', ['마', '맣']],
    ['먀', ['먀', '먛']],
    ['머', ['머', '멓']],
    ['며', ['며', '몋']],
    ['모', ['모', '뫃']],
    ['묘', ['묘', '묳']],
    ['무', ['무', '뭏']],
    ['뮤', ['뮤', '뮿']],
    ['므', ['므', '믛']],
    ['미', ['미', '밓']],

    ['바', ['바', '밯']],
    ['뱌', ['뱌', '뱧']],
    ['버', ['버', '벟']],
    ['벼', ['벼', '볗']],
    ['보', ['보', '봏']],
    ['뵤', ['뵤', '뵿']],
    ['부', ['부', '붛']],
    ['뷰', ['뷰', '븋']],
    ['브', ['브', '븧']],
    ['비', ['비', '빟']],

    ['사', ['사', '샇']],
    ['샤', ['샤', '샿']],
    ['서', ['서', '섷']],
    ['셔', ['셔', '셯']],
    ['소', ['소', '솧']],
    ['쇼', ['쇼', '숗']],
    ['수', ['수', '숳']],
    ['슈', ['슈', '슣']],
    ['스', ['스', '슿']],
    ['시', ['시', '싷']],

    ['아', ['아', '앟']],
    ['야', ['야', '얗']],
    ['어', ['어', '엏']],
    ['여', ['여', '옇']],
    ['오', ['오', '옿']],
    ['요', ['요', '욯']],
    ['우', ['우', '웋']],
    ['유', ['유', '윻']],
    ['으', ['으', '읗']],
    ['이', ['이', '잏']],

    ['자', ['자', '잫']],
    ['쟈', ['쟈', '쟣']],
    ['저', ['저', '젛']],
    ['져', ['져', '졓']],
    ['조', ['조', '좋']],
    ['죠', ['죠', '죻']],
    ['주', ['주', '줗']],
    ['쥬', ['쥬', '즇']],
    ['즈', ['즈', '즣']],
    ['지', ['지', '짛']],

    ['차', ['차', '챃']],
    ['챠', ['챠', '챻']],
    ['처', ['처', '첳']],
    ['쳐', ['쳐', '첳']],
    ['초', ['초', '촣']],
    ['쵸', ['쵸', '촣']],
    ['추', ['추', '춯']],
    ['츄', ['츄', '츟']],
    ['츠', ['츠', '츻']],
    ['치', ['치', '칳']],

    ['카', ['카', '캏']],
    ['캬', ['캬', '캏']],
    ['커', ['커', '컿']],
    ['켜', ['켜', '켷']],
    ['코', ['코', '콯']],
    ['쿄', ['쿄', '쿟']],
    ['쿠', ['쿠', '큫']],
    ['큐', ['큐', '큫']],
    ['크', ['크', '킇']],
    ['키', ['키', '킿']],

    ['타', ['타', '탛']],
    ['탸', ['탸', '턓']],
    ['터', ['터', '텋']],
    ['텨', ['텨', '톃']],
    ['토', ['토', '톻']],
    ['툐', ['툐', '툫']],
    ['투', ['투', '퉇']],
    ['튜', ['튜', '튷']],
    ['트', ['트', '틓']],
    ['티', ['티', '팋']],

    ['파', ['파', '팧']],
    ['퍄', ['퍄', '퍟']],
    ['퍼', ['퍼', '펗']],
    ['펴', ['펴', '폏']],
    ['포', ['포', '퐇']],
    ['표', ['표', '푷']],
    ['푸', ['푸', '풓']],
    ['퓨', ['퓨', '픃']],
    ['프', ['프', '픟']],
    ['피', ['피', '핗']],

    ['하', ['하', '핳']],
    ['햐', ['햐', '햫']],
    ['허', ['허', '헣']],
    ['혀', ['혀', '혛']],
    ['호', ['호', '홓']],
    ['효', ['효', '훃']],
    ['후', ['후', '훟']],
    ['휴', ['휴', '흏']],
    ['흐', ['흐', '흫']],
    ['히', ['히', '힣']],
]);

exports.isConsonants = (word) => {
    return ![...word].some((c) => !ConsonantEndingMap.has(c));
};

exports.getWhereClause = (word, column) => {
    const clause = [...word].reduce((p, c, i) => {
        if (!this.isConsonants(c)) {
            disassemble = Hangul.disassemble(c);
            //자음 + 모음
            if (disassemble.length === 2) {
                return (
                    p +
                    `SUBSTR(${column}, ${i + 1}, 1) >= '${
                        VowelEndingtMap.get(c)[0]
                    }' AND SUBSTR(${column}, ${i + 1}, 1) < '${VowelEndingtMap.get(c)[1]}' AND `
                );
            }
            //자음 + 모음 + 자음
            else {
                return p + `${column} LIKE '%${c}%' AND `;
            }
        }

        //자음
        else {
            return (
                p +
                `SUBSTR(${column}, ${i + 1}, 1) >= '${
                    ConsonantEndingMap.get(c)[0]
                }' AND SUBSTR(${column}, ${i + 1}, 1) < '${ConsonantEndingMap.get(c)[1]}' AND `
            );
        }
    }, '');
    return clause.substring(0, clause.length - 5);
};
