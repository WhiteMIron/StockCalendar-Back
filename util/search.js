const Hangul = require('hangul-js');

const ConsonantEndingMap = new Map([
    ['ㄱ', ['가', '까']],
    ['ㄲ', ['까', '나']],
    ['ㄴ', ['낙', '닥']],
    ['ㄷ', ['다', '따']],
    ['ㄸ', ['따', '라']],
    ['ㄹ', ['라', '마']],
    ['ㅁ', ['마', '바']],
    ['ㅂ', ['바', '빠']],
    ['ㅃ', ['빠', '사']],
    ['ㅅ', ['사', '싸']],
    ['ㅆ', ['싸', '아']],
    ['ㅇ', ['아', '자']],
    ['ㅈ', ['자', '짜']],
    ['ㅉ', ['짜', '차']],
    ['ㅊ', ['차', '카']],
    ['ㅋ', ['카', '타']],
    ['ㅌ', ['타', '파']],
    ['ㅍ', ['파', '하']],
    ['ㅎ', ['하', '힣']],
]);

const VowelEndingMap = new Map([
    ['가', ['가', '갛']],
    ['갸', ['갸', '걓']],
    ['거', ['거', '겋']],
    ['겨', ['겨', '곃']],
    ['고', ['고', '굫']],
    ['교', ['교', '굫']],
    ['구', ['구', '궇']],
    ['규', ['규', '귷']],
    ['그', ['그', '긓']],
    ['기', ['기', '깋']],
    ['개', ['개', '갷']],
    ['걔', ['걔', '걯']],
    ['게', ['게', '겧']],
    ['계', ['계', '곟']],
    ['과', ['과', '괗']],
    ['괘', ['괘', '괳']],
    ['괴', ['괴', '굏']],
    ['궈', ['궈', '궣']],
    ['궤', ['궤', '궿']],
    ['귀', ['귀', '귛']],
    ['긔', ['긔', '긯']],

    ['나', ['나', '낳']],
    ['냐', ['냐', '낳']],
    ['너', ['너', '넣']],
    ['녀', ['녀', '녛']],
    ['노', ['노', '놓']],
    ['뇨', ['뇨', '눃']],
    ['누', ['누', '늏']],
    ['뉴', ['뉴', '늏']],
    ['느', ['느', '늫']],
    ['니', ['니', '닣']],
    ['내', ['내', '냏']],
    ['냬', ['냬', '넿']],
    ['네', ['네', '넿']],
    ['녜', ['녜', '녷']],
    ['놔', ['놔', '놯']],
    ['놰', ['놰', '뇋']],
    ['뇌', ['뇌', '뇧']],
    ['눠', ['눠', '눻']],
    ['눼', ['눼', '뉗']],
    ['뉘', ['뉘', '뉳']],
    ['늬', ['늬', '닇']],

    ['다', ['다', '닿']],
    ['댜', ['댜', '댷']],
    ['더', ['더', '덯']],
    ['뎌', ['뎌', '뎧']],
    ['도', ['도', '돟']],
    ['됴', ['됴', '둏']],
    ['두', ['두', '듛']],
    ['듀', ['듀', '듛']],
    ['드', ['드', '듷']],
    ['디', ['디', '딯']],
    ['대', ['대', '댛']],
    ['댸', ['댸', '덓']],
    ['데', ['데', '뎋']],
    ['뎨', ['뎨', '돃']],
    ['돠', ['돠', '돻']],
    ['돼', ['돼', '됗']],
    ['되', ['되', '됳']],
    ['둬', ['둬', '뒇']],
    ['뒈', ['뒈', '뒣']],
    ['뒤', ['뒤', '뒿']],
    ['듸', ['듸', '딓']],

    ['라', ['라', '랗']],
    ['랴', ['랴', '럏']],
    ['러', ['러', '렇']],
    ['려', ['려', '렿']],
    ['로', ['로', '롷']],
    ['료', ['료', '룧']],
    ['루', ['루', '뤃']],
    ['류', ['류', '륳']],
    ['르', ['르', '릏']],
    ['리', ['리', '맇']],
    ['래', ['래', '랳']],
    ['럐', ['럐', '럫']],
    ['레', ['레', '렣']],
    ['례', ['례', '롛']],
    ['롸', ['롸', '뢓']],
    ['뢔', ['뢔', '뢯']],
    ['뢰', ['뢰', '룋']],
    ['뤄', ['뤄', '뤟']],
    ['뤠', ['뤠', '뤻']],
    ['뤼', ['뤼', '륗']],
    ['릐', ['릐', '릫']],

    ['마', ['마', '맣']],
    ['먀', ['먀', '먛']],
    ['머', ['머', '멓']],
    ['며', ['며', '몋']],
    ['모', ['모', '뫃']],
    ['묘', ['묘', '묳']],
    ['무', ['무', '뭏']],
    ['뮤', ['뮤', '뮿']],
    ['므', ['므', '믛']],
    ['미', ['미', '밓']],
    ['매', ['매', '맿']],
    ['먜', ['먜', '먷']],
    ['메', ['메', '멯']],
    ['몌', ['몌', '몧']],
    ['뫄', ['뫄', '뫟']],
    ['뫠', ['뫠', '뫻']],
    ['뫼', ['뫼', '묗']],
    ['뭐', ['뭐', '뭫']],
    ['뭬', ['뭬', '뮇']],
    ['뮈', ['뮈', '뮣']],
    ['믜', ['믜', '믷']],

    ['바', ['바', '밯']],
    ['뱌', ['뱌', '뱧']],
    ['버', ['버', '벟']],
    ['벼', ['벼', '볗']],
    ['보', ['보', '봏']],
    ['뵤', ['뵤', '뵿']],
    ['부', ['부', '붛']],
    ['뷰', ['뷰', '븋']],
    ['브', ['브', '븧']],
    ['비', ['비', '빟']],
    ['배', ['배', '뱋']],
    ['뱨', ['뱨', '벃']],
    ['베', ['베', '벻']],
    ['볘', ['볘', '볳']],
    ['봐', ['봐', '봫']],
    ['봬', ['봬', '뵇']],
    ['뵈', ['뵈', '뵣']],
    ['붜', ['붜', '붷']],
    ['붸', ['붸', '뷓']],
    ['뷔', ['뷔', '뷯']],
    ['븨', ['븨', '빃']],

    ['사', ['사', '샇']],
    ['샤', ['샤', '샿']],
    ['서', ['서', '섷']],
    ['셔', ['셔', '셯']],
    ['소', ['소', '솧']],
    ['쇼', ['쇼', '숗']],
    ['수', ['수', '숳']],
    ['슈', ['슈', '슣']],
    ['스', ['스', '슿']],
    ['시', ['시', '싷']],
    ['새', ['새', '샣']],
    ['섀', ['섀', '섛']],
    ['세', ['세', '셓']],
    ['셰', ['셰', '솋']],
    ['솨', ['솨', '쇃']],
    ['쇄', ['쇄', '쇟']],
    ['쇠', ['쇠', '쇻']],
    ['숴', ['숴', '쉏']],
    ['쉐', ['쉐', '쉫']],
    ['쉬', ['쉬', '슇']],
    ['싀', ['싀', '싛']],

    ['아', ['아', '앟']],
    ['야', ['야', '얗']],
    ['어', ['어', '엏']],
    ['여', ['여', '옇']],
    ['오', ['오', '옿']],
    ['요', ['요', '욯']],
    ['우', ['우', '웋']],
    ['유', ['유', '윻']],
    ['으', ['으', '읗']],
    ['이', ['이', '잏']],
    ['애', ['애', '앻']],
    ['얘', ['얘', '얳']],
    ['에', ['에', '엫']],
    ['예', ['예', '옣']],
    ['와', ['와', '왛']],
    ['왜', ['왜', '왷']],
    ['외', ['외', '욓']],
    ['워', ['워', '웧']],
    ['웨', ['웨', '윃']],
    ['위', ['위', '윟']],
    ['의', ['의', '읳']],

    ['자', ['자', '잫']],
    ['쟈', ['쟈', '쟣']],
    ['저', ['저', '젛']],
    ['져', ['져', '졓']],
    ['조', ['조', '좋']],
    ['죠', ['죠', '죻']],
    ['주', ['주', '줗']],
    ['쥬', ['쥬', '즇']],
    ['즈', ['즈', '즣']],
    ['지', ['지', '짛']],
    ['재', ['재', '쟇']],
    ['쟤', ['쟤', '쟿']],
    ['제', ['제', '젷']],
    ['졔', ['졔', '졯']],
    ['좌', ['좌', '좧']],
    ['좨', ['좨', '죃']],
    ['죄', ['죄', '죟']],
    ['줘', ['줘', '줳']],
    ['줴', ['줴', '쥏']],
    ['쥐', ['쥐', '쥫']],
    ['즤', ['즤', '즿']],

    ['차', ['차', '챃']],
    ['챠', ['챠', '챻']],
    ['처', ['처', '첳']],
    ['쳐', ['쳐', '첳']],
    ['초', ['초', '촣']],
    ['쵸', ['쵸', '촣']],
    ['추', ['추', '춯']],
    ['츄', ['츄', '츟']],
    ['츠', ['츠', '츻']],
    ['치', ['치', '칳']],
    ['채', ['채', '챟']],
    ['챼', ['챼', '첗']],
    ['체', ['체', '쳏']],
    ['쳬', ['쳬', '촇']],
    ['촤', ['촤', '촿']],
    ['쵀', ['쵀', '쵛']],
    ['최', ['최', '쵷']],
    ['춰', ['춰', '췋']],
    ['췌', ['췌', '췧']],
    ['취', ['취', '츃']],
    ['츼', ['츼', '칗']],

    ['카', ['카', '캏']],
    ['캬', ['캬', '캏']],
    ['커', ['커', '컿']],
    ['켜', ['켜', '켷']],
    ['코', ['코', '콯']],
    ['쿄', ['쿄', '쿟']],
    ['쿠', ['쿠', '큫']],
    ['큐', ['큐', '큫']],
    ['크', ['크', '킇']],
    ['키', ['키', '킿']],
    ['캐', ['캐', '캫']],
    ['컈', ['컈', '컣']],
    ['케', ['케', '켛']],
    ['켸', ['켸', '콓']],
    ['콰', ['콰', '쾋']],
    ['쾌', ['쾌', '쾧']],
    ['쾨', ['쾨', '쿃']],
    ['쿼', ['쿼', '퀗']],
    ['퀘', ['퀘', '퀳']],
    ['퀴', ['퀴', '큏']],
    ['킈', ['킈', '킣']],

    ['타', ['타', '탛']],
    ['탸', ['탸', '턓']],
    ['터', ['터', '텋']],
    ['텨', ['텨', '톃']],
    ['토', ['토', '톻']],
    ['툐', ['툐', '툫']],
    ['투', ['투', '퉇']],
    ['튜', ['튜', '튷']],
    ['트', ['트', '틓']],
    ['티', ['티', '팋']],
    ['태', ['태', '탷']],
    ['턔', ['턔', '턯']],
    ['테', ['테', '텧']],
    ['톄', ['톄', '톟']],
    ['톼', ['톼', '퇗']],
    ['퇘', ['퇘', '퇳']],
    ['퇴', ['퇴', '툏']],
    ['퉈', ['퉈', '퉣']],
    ['퉤', ['퉤', '퉿']],
    ['튀', ['튀', '튛']],
    ['틔', ['틔', '틯']],

    ['파', ['파', '팧']],
    ['퍄', ['퍄', '퍟']],
    ['퍼', ['퍼', '펗']],
    ['펴', ['펴', '폏']],
    ['포', ['포', '퐇']],
    ['표', ['표', '푷']],
    ['푸', ['푸', '풓']],
    ['퓨', ['퓨', '픃']],
    ['프', ['프', '픟']],
    ['피', ['피', '핗']],
    ['패', ['패', '퍃']],
    ['퍠', ['퍠', '퍻']],
    ['페', ['페', '펳']],
    ['폐', ['폐', '폫']],
    ['퐈', ['퐈', '퐣']],
    ['퐤', ['퐤', '퐿']],
    ['푀', ['푀', '푛']],
    ['풔', ['풔', '풯']],
    ['풰', ['풰', '퓋']],
    ['퓌', ['퓌', '퓧']],
    ['픠', ['픠', '픻']],

    ['하', ['하', '핳']],
    ['햐', ['햐', '햫']],
    ['허', ['허', '헣']],
    ['혀', ['혀', '혛']],
    ['호', ['호', '홓']],
    ['효', ['효', '훃']],
    ['후', ['후', '훟']],
    ['휴', ['휴', '흏']],
    ['흐', ['흐', '흫']],
    ['히', ['히', '힣']],
    ['해', ['해', '햏']],
    ['햬', ['햬', '헇']],
    ['헤', ['헤', '헿']],
    ['혜', ['혜', '혷']],
    ['화', ['화', '홯']],
    ['홰', ['홰', '횋']],
    ['회', ['회', '횧']],
    ['훠', ['훠', '훻']],
    ['훼', ['훼', '휗']],
    ['휘', ['휘', '휳']],
    ['희', ['희', '힇']],
]);

exports.isConsonants = (word) => {
    return ![...word].some((c) => !ConsonantEndingMap.has(c));
};

exports.getWhereClause = (word, column) => {
    console.log(word);
    const clause = [...word].reduce((p, c, i) => {
        if (!this.isConsonants(c)) {
            disassemble = Hangul.disassemble(c);

            if (!Hangul.isCho(c) && disassemble.length === 2) {
                console.log(c);
                return (
                    p +
                    `SUBSTR(${column}, ${i + 1}, 1) >= '${
                        VowelEndingMap.get(c)[0]
                    }' AND SUBSTR(${column}, ${i + 1}, 1) < '${VowelEndingMap.get(c)[1]}' AND `
                );
            }
            //자음 + 모음 + 자음
            else {
                return p + `${column} LIKE '%${c}%' AND `;
            }
        } else {
            //자음
            return (
                p +
                `SUBSTR(${column}, ${i + 1}, 1) >= '${
                    ConsonantEndingMap.get(c)[0]
                }' AND SUBSTR(${column}, ${i + 1}, 1) < '${ConsonantEndingMap.get(c)[1]}' AND `
            );
        }
    }, '');
    return clause.substring(0, clause.length - 5);
};
